<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‚òÄÔ∏èü•µ</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/htmx.org/dist/htmx.min.js"></script>
  </head>

  <body class="bg-gray-100">
    <div class="container mx-auto py-8">
      <h1 class="text-3xl font-bold mb-4">Running Pace Calculator for Hot Weather ‚òÄÔ∏èü•µ</h1>
      <form
        id="paceForm"
        hx-post="/calculate"
        hx-target="#result"
        hx-swap="innerHTML"
        class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4"
      >
        <div class="mb-4">
          <label
            for="location"
            class="block text-gray-700 text-sm font-bold mb-2"
            >Enter City or Zip Code:</label
          >
          <input
            type="text"
            id="location"
            name="location"
            required
            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          />
        </div>

        <div class="mb-4">
          <label for="pace" class="block text-gray-700 text-sm font-bold mb-2"
            >Current Pace (<span id="paceUnit">min:sec per mile</span>):</label
          >
          <input
            type="text"
            id="pace"
            name="pace"
            placeholder="e.g. 7:00"
            required
            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          />
        </div>

        <div class="mb-4">
          <label
            for="distance"
            class="block text-gray-700 text-sm font-bold mb-2"
            >Run Type:</label
          >
          <select
            id="distance"
            name="distance"
            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          >
            <option value="continuous">Continuous Run</option>
            <option value="interval">Interval Training</option>
          </select>
        </div>

        <div class="flex items-center mb-4">
          <span class="mr-2">Imperial</span>
          <label class="switch">
            <input type="checkbox" id="unitToggle" name="unitToggle" />
            <span class="slider"></span>
          </label>
          <span class="ml-2">Metric</span>
        </div>

        <button
          type="submit"
          id="calculateButton"
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
        >
          Calculate Adjusted Pace
        </button>
      </form>

      <div
        id="result"
        class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4"
      ></div>

      <div
        class="forecast-container bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4"
        id="forecastContainer"
        hx-get="/forecast"
        hx-trigger="load"
      >
        <!-- Forecast will be loaded here -->
      </div>

      <div
        id="stepsSection"
        class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4"
      ></div>

      <div
        id="infoSection"
        class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4"
      >
        <h2 class="text-xl font-bold mb-4">About This Calculator</h2>
        <p class="text-sm text-gray-700 leading-relaxed mb-4">
          This pace calculator is based on the Temperature + Dew Point
          adjustment method for runners. It helps you adjust your running pace
          based on current weather conditions to maintain optimal performance
          and safety.
        </p>
        <p class="text-sm text-gray-700 leading-relaxed mb-4">
          The adjustment formula considers both temperature and dew point to
          determine how much you should slow down your pace in challenging
          weather conditions.
        </p>
        <h3 class="text-lg font-bold mb-2">Credit</h3>
        <p class="text-sm text-gray-700 leading-relaxed mb-4">
          This calculator is based on the work published by Maximum Performance
          Running. For more detailed information, please visit the original
          post:
        </p>
        <a
          href="https://maximumperformancerunning.blogspot.com/2013/07/temperature-dew-point.html"
          class="text-blue-500 hover:text-blue-700"
          target="_blank"
          >Temperature + Dew Point For Pace Adjustments</a
        >
      </div>
    </div>

    <script>
      document
        .getElementById("unitToggle")
        .addEventListener("change", function () {
          document.getElementById("paceUnit").textContent = this.checked
            ? "min:sec per km"
            : "min:sec per mile";
        });

      document
        .getElementById("paceForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const form = e.target;
          const formData = new FormData(form);

          try {
            const response = await fetch("/calculate", {
              method: "POST",
              body: formData,
            });

            if (!response.ok) {
              throw new Error("Error calculating pace");
            }

            const data = await response.json();

            if (data.error) {
              document.getElementById("result").innerHTML =
                `<p class="text-red-500">${data.error}</p>`;
              return;
            }

            const {
              location,
              temp,
              dew_point,
              humidity,
              is_metric,
              adjusted_min,
              adjusted_sec,
            } = data;

            const unit = is_metric ? "km" : "mile";

            document.getElementById("result").innerHTML = `
                <h3 class="text-xl font-bold mb-2">Adjusted Pace</h3>
                <p>Current conditions in ${location}:</p>
                <p>Temperature: ${temp}${is_metric ? "¬∞C" : "¬∞F"}</p>
                <p>Dew Point: ${dew_point}${is_metric ? "¬∞C" : "¬∞F"}</p>
                <p>Humidity: ${humidity}%</p>
                <p>Adjusted Pace: ${adjusted_min}:${adjusted_sec.toString().padStart(2, "0")} per ${unit}</p>
            `;
          } catch (error) {
            console.error("Error:", error);
            document.getElementById("result").innerHTML =
              '<p class="text-red-500">Error fetching data. Please try again.</p>';
          }
        });
    </script>
  </body>
</html>
